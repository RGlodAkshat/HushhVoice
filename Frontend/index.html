<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>HushhVoice — Your private, consent-first AI copilot</title>
  <meta name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <meta name="color-scheme" content="dark light" />
  <meta name="description"
    content="HushhVoice is a consent-first personal AI that helps with email, scheduling, and visual understanding." />
  <meta name="theme-color" content="#0b0f14" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="preload" as="image" href="Images/HushhVoice_Logo.png" imagesrcset="Images/HushhVoice_Logo.png" />
  <link rel="stylesheet" href="style.css" />

  <!-- Space Grotesk (display) + Sora (UI) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400..700&family=Sora:wght@300..800&display=swap"
    rel="stylesheet" />

  <!-- Font nudges -->
  <style>
    :root {
      --font: 14px/1.6 "Sora", system-ui, -apple-system, "Segoe UI", Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      --font-display: "Space Grotesk", "Sora", system-ui, -apple-system, "Segoe UI", Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .brand-text .app-title,
    .section-title,
    .profile-name,
    #rag-memory-title {
      font-family: var(--font-display);
      letter-spacing: .2px
    }

    body,
    .btn,
    .input,
    .chat-box,
    .section-title,
    .app-title {
      font-variant-numeric: proportional-nums slashed-zero;
      font-feature-settings: "ss01" 1, "cv01" 1;
    }

    .bg-logo {
      pointer-events: none
    }
  </style>

  <!-- Google One-Tap (unchanged) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <noscript>
    <div class="noscript">HushhVoice needs JavaScript to run. Please enable it and reload.</div>
  </noscript>

  <!-- Skip link -->
  <a href="#chat" class="visually-hidden focusable">Skip to chat</a>

  <!-- Ambient -->
  <div class="bg-anim" aria-hidden="true"></div>
  <div class="bg-stars" aria-hidden="true">
    <div class="stars"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
  </div>
  <img class="bg-logo" src="Images/HushhVoice_Logo.png" alt="" aria-hidden="true" />

  <div class="app-layout">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Profile and settings">
      <nav class="sidebar-content" aria-label="Chats and tools">
        <!-- CHATS PANEL -->
        <section id="chats-panel" class="u-card chats-card" aria-labelledby="chats-title">
          <header class="chats-head">
            <h2 id="chats-title" class="section-title">Chats</h2>

            <button id="chat-new" class="btn primary chats-new" type="button" aria-label="Start a new chat">
              ＋ New Chat
            </button>

            <div class="chats-search">
              <label for="chat-search" class="visually-hidden">Search chats</label>
              <input id="chat-search" class="field chats-search-input" type="search" placeholder="Search…"
                autocomplete="off" />
            </div>
          </header>

          <div class="chats-list-wrap u-focus-within" role="region" aria-label="Chat threads">
            <ol id="chat-threads" class="threads-list" aria-live="polite" aria-relevant="additions removals"></ol>
            <div id="chats-empty" class="threads-empty" aria-live="polite">
              No chats yet. Click <b>New Chat</b> to start one.
            </div>
          </div>
        </section>

        <!-- Thread item template -->
        <template id="tpl-chat-thread">
          <li class="thread" data-id="">
            <button class="thread-main" type="button" aria-label="Open chat">
              <div class="thread-top">
                <span class="thread-title">Untitled</span>
                <time class="thread-time" datetime="" aria-label="Last updated"></time>
              </div>
              <p class="thread-snippet">—</p>
            </button>

            <div class="thread-actions" role="group" aria-label="Chat actions">
              <button class="btn action pin thread-pin" type="button" title="Pin chat" aria-label="Pin chat">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
                  <path d="M14 2l4 4-2 2 3 3-2 2-3-3-2 2-4-4 2-2-4-4 4 4 2-2zM5 21l6-6 2 2-6 6H5z" />
                </svg>
                <span class="action-label">Pin</span>
              </button>

              <button class="btn action rename thread-rename" type="button" title="Rename chat"
                aria-label="Rename chat">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
                  <path
                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41L18.37 3.29a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                </svg>
                <span class="action-label">Rename</span>
              </button>

              <button class="btn action danger thread-delete" type="button" title="Delete chat"
                aria-label="Delete chat">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
                  <path d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2z" />
                </svg>
                <span class="action-label">Delete</span>
              </button>
            </div>
          </li>
        </template>

        <!-- Context menu -->
        <template id="tpl-thread-menu">
          <div class="thread-menu" role="menu">
            <button class="menu-item" type="button" role="menuitem" data-action="pin">Pin/Unpin</button>
            <button class="menu-item" type="button" role="menuitem" data-action="rename">Rename</button>
            <hr class="menu-sep" />
            <button class="menu-item danger" type="button" role="menuitem" data-action="delete">Delete</button>
          </div>
        </template>

        <!-- Rename modal -->
        <dialog id="thread-rename-modal" class="modal" aria-labelledby="thread-rename-title" aria-modal="true">
          <form id="thread-rename-form" method="dialog">
            <h3 id="thread-rename-title">Rename chat</h3>
            <label for="thread-rename-input" class="visually-hidden">Chat title</label>
            <input id="thread-rename-input" class="field" type="text" maxlength="120" placeholder="New title…" />
            <div class="modal-actions">
              <button class="btn btn-ghost" value="cancel" type="submit">Cancel</button>
              <button id="thread-rename-save" class="btn primary" value="default" type="submit">Save</button>
            </div>
          </form>
        </dialog>
      </nav>

      <div class="sidebar-footer">
        <div class="profile-mini">
          <h2 class="profile-name" id="profile-handle">you</h2>
          <p class="profile-subtitle" id="profile-subtitle">Signed-out</p>
        </div>
      </div>
      
    </aside>

    <!-- Main App -->
    <div class="app" id="app">
      <!-- Topbar -->
      <header class="topbar" role="banner">
        <button id="sidebar-toggle" class="btn icon" aria-label="Toggle sidebar" aria-controls="sidebar"
          aria-expanded="false" type="button">☰</button>

        <a class="brand" href="#" aria-label="HushhVoice home">
          <img src="Images/HushhVoice_Logo.png" alt="HushhVoice Logo" class="logo" width="68" height="68"
            decoding="async" />
          <div class="brand-text">
            <h1 class="app-title">HushhVoice</h1>
            <p class="app-sub">Your private, consent-first AI copilot</p>
          </div>
        </a>

        <!-- AUTH AREA (UNCHANGED) -->
        <div class="auth" aria-live="polite">
          <div id="google-login" class="google-login" aria-label="Sign in with Google"></div>
          <div id="user-info" class="user-info" style="display:none">
            <span id="user-email" class="user-email" aria-label="Signed in email"></span>
            <button id="logout-btn" class="btn btn-ghost small" type="button" aria-label="Log out">Logout</button>
          </div>
        </div>
      </header>

      <!-- Chat -->
      <main class="chat" id="chat" role="main" aria-label="Chat conversation">
        <ol id="chat-box" class="chat-box" aria-live="polite" aria-relevant="additions text"></ol>
      </main>

      <!-- Composer -->
      <footer class="composer" role="contentinfo">
        <div class="composer-inner">
          <!-- Attachment bar -->
          <div id="attachment-bar" class="attachment-bar" style="display:none" aria-live="polite"></div>

          <div class="input-row">
            <!-- TOOLTRAY: camera | gallery | mic | stop -->
            <div class="tooltray" role="group" aria-label="Quick actions">
              <button id="stop-btn" class="btn icon stop" title="Stop speaking" aria-label="Stop speaking"
                type="button">⏹</button>
              <!-- Hidden file inputs (kept near triggers) -->
              <input id="image-input" type="file" accept="image/*" capture="environment" class="visually-hidden" />
              <input id="image-input-gallery" type="file" accept="image/*" class="visually-hidden" />
            </div>

            <!-- Textarea -->
            <label for="user-input" class="visually-hidden">Message HushhVoice</label>
            <textarea id="user-input" class="input" placeholder="Message HushhVoice…" rows="1" autocomplete="off"
              autocorrect="on" spellcheck="true" aria-multiline="true"></textarea>

            <!-- Send -->
            <button id="send-btn" class="btn primary send" aria-label="Send message" type="button">➤</button>
          </div>

          <!-- Hints -->
          <div class="hints">
            <span>
              Press <kbd>Enter</kbd> to send • <kbd>Shift</kbd>+<kbd>Enter</kbd> for a new line.
            </span>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Message Templates -->
  <template id="tpl-typing">
    <li class="msg bot typing" data-role="assistant" aria-live="polite">
      <div class="avatar" aria-hidden="true">🤖</div>
      <div class="bubble"><span class="dots"><i></i><i></i><i></i></span></div>
    </li>
  </template>

  <template id="tpl-assistant">
    <li class="msg bot" data-role="assistant">
      <div class="avatar" aria-hidden="true">🤖</div>
      <div class="bubble">
        <div class="content"></div>

        <!-- Actions under assistant response -->
        <div class="msg-actions" role="group" aria-label="Message actions">
          <button class="btn tiny speak-btn" type="button" title="Speak this response" aria-label="Speak this response">
            🔈 Speak
          </button>
        </div>
      </div>
    </li>
  </template>

  <template id="tpl-user">
    <li class="msg user" data-role="user">
      <div class="avatar" aria-hidden="true">🧑</div>
      <div class="bubble">
        <div class="content"></div>
      </div>
    </li>
  </template>

  <!-- Toasts -->
  <div id="toasts" class="toasts" aria-live="assertive" aria-atomic="true"></div>

  <!-- Mic Help -->
  <dialog id="mic-help" class="modal" aria-labelledby="mic-help-title">
    <form method="dialog">
      <h3 id="mic-help-title">Enable your microphone</h3>
      <p>Your browser blocked mic access. Click the lock icon in the address bar → allow microphone, then try again.</p>
      <div class="modal-actions">
        <button class="btn primary" type="submit">OK</button>
      </div>
    </form>
  </dialog>

  <!-- SETTINGS MODAL (Bio + RAG moved here) -->
  <dialog id="settings-modal" class="modal settings-modal" aria-labelledby="settings-title" aria-modal="true">
    <form id="settings-form" method="dialog">
      <header class="settings-header">
        <div class="settings-title-wrap">
          <div class="settings-icon" aria-hidden="true">⚙️</div>
          <div>
            <h3 id="settings-title" class="settings-title">Settings</h3>
            <p class="settings-sub">Private by default. You’re always in control.</p>
          </div>
        </div>
        <button class="btn btn-ghost small settings-close" value="cancel" type="submit"
          aria-label="Close settings">✕</button>
      </header>

      <div class="settings-panel">
        <!-- Consent options -->
        <section class="pane">
          <div class="pane-head">
            <h4 class="section-title">Data Consent</h4>
            <p class="section-sub">Choose which sources to allow data</p>
          </div>

          <div class="consent-grid">
            <label class="consent-card" for="consent-mail" role="group" aria-labelledby="consent-mail-label"
              aria-describedby="consent-mail-desc">
              <div class="consent-meta">
                <div class="consent-icon" aria-hidden="true">📧</div>
                <div>
                  <div id="consent-mail-label" class="consent-title">Mail</div>
                  <div id="consent-mail-desc" class="consent-desc">Gmail inbox and summaries</div>
                </div>
              </div>
              <input type="checkbox" id="consent-mail" class="switch-input" />
              <span class="switch"></span>
            </label>

            <label class="consent-card" for="consent-calendar" role="group" aria-labelledby="consent-calendar-label"
              aria-describedby="consent-calendar-desc">
              <div class="consent-meta">
                <div class="consent-icon" aria-hidden="true">🗓️</div>
                <div>
                  <div id="consent-calendar-label" class="consent-title">Calendar</div>
                  <div id="consent-calendar-desc" class="consent-desc">Agenda, meetings, reminders</div>
                </div>
              </div>
              <input type="checkbox" id="consent-calendar" class="switch-input" />
              <span class="switch"></span>
            </label>

            <label class="consent-card" for="consent-health" role="group" aria-labelledby="consent-health-label"
              aria-describedby="consent-health-desc">
              <div class="consent-meta">
                <div class="consent-icon" aria-hidden="true">💓</div>
                <div>
                  <div id="consent-health-label" class="consent-title">Health</div>
                  <div id="consent-health-desc" class="consent-desc">Steps, sleep, wellness trends</div>
                </div>
              </div>
              <input type="checkbox" id="consent-health" class="switch-input" />
              <span class="switch"></span>
            </label>

            <label class="consent-card" for="consent-phone" role="group" aria-labelledby="consent-phone-label"
              aria-describedby="consent-phone-desc">
              <div class="consent-meta">
                <div class="consent-icon" aria-hidden="true">📱</div>
                <div>
                  <div id="consent-phone-label" class="consent-title">Phone data</div>
                  <div id="consent-phone-desc" class="consent-desc">Device usage and context</div>
                </div>
              </div>
              <input type="checkbox" id="consent-phone" class="switch-input" />
              <span class="switch"></span>
            </label>

            <label class="consent-card" for="consent-app" role="group" aria-labelledby="consent-app-label"
              aria-describedby="consent-app-desc">
              <div class="consent-meta">
                <div class="consent-icon" aria-hidden="true">📦</div>
                <div>
                  <div id="consent-app-label" class="consent-title">App data</div>
                  <div id="consent-app-desc" class="consent-desc">Connected apps and integrations</div>
                </div>
              </div>
              <input type="checkbox" id="consent-app" class="switch-input" />
              <span class="switch"></span>
            </label>
          </div>
        </section>

        <hr class="pane-divider" />

        <!-- About me -->
        <section class="pane">
          <div class="pane-head">
            <h4 class="section-title">About me</h4>
            <p class="section-sub">A short bio helps personalize your assistant’s tone and answers.</p>
          </div>
          <label for="bio-text-inline" class="visually-hidden">Bio</label>
          <textarea id="bio-text-inline" class="field" rows="4" maxlength="600"
            placeholder="Write a short bio… (e.g., 'Founder at Hushh. I batch email at 9pm.')"></textarea>
          <div class="section-actions">
            <span class="char-hint" id="bio-char-hint"><b>0</b>/600</span>
            <button id="bio-save-inline" class="btn primary small" type="button">Save Bio</button>
          </div>
        </section>

        <hr class="pane-divider" />

        <!-- RAG Memory -->
        <section class="pane">
          <div class="pane-head">
            <h4 class="section-title">RAG Memory</h4>
            <p class="section-sub">Teach HushhVoice small facts. Short and clear works best.</p>
          </div>

          <div class="memory-form">
            <input id="memory-inline" class="field" type="text" maxlength="600"
              placeholder="e.g., ‘I prefer 30-min meetings after 2pm.’" />
            <button id="memory-add-inline" class="btn primary small" type="button">Add</button>
          </div>

          <div class="memory-log-wrap u-focus-within">
            <ol id="memory-log-inline" class="memory-log"></ol>
          </div>

          <div class="memory-actions">
            <button id="memory-clear-inline" class="btn small btn-ghost" type="button">Clear All</button>
          </div>
        </section>
      </div>

      <footer class="modal-actions settings-actions">
        <button class="btn btn-ghost" value="cancel" type="submit">Close</button>
      </footer>
    </form>
  </dialog>

  <!-- Markdown + XSS sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <!-- App logic -->
  <script src="script.js" defer></script>
</body>

</html>